## 短信校验的血与泪

data: 2017-12-20

- 祸患隐现

在一个月前的下午,当时风和日丽，在去食堂吃饭的路上和领导讨论如何进行系统预警，因为一次订单积压，领导未能及时发现，我想了想，客户提供了短信接口，我们除了用来做短信校验，完全也可以用来做预警短信嘛！领导觉得不错就在系统中添加了预警短信，但是我想到我们的短信校验接口好像是完全裸露在外的，没有session校验，注册的时候也没办法做session校验，用前端的跨域调试就能调用我们的接口，此外还可以使用postman这样的工具，更可怕的是，如果用人用python写个脚本，估计能嗨翻天。

- 厄运如约而至

世上该来的事情终究会来的，果然突然有一天就是今天，发现系统正在疯狂的发短信，我有种不详的预感，这应该不是系统故障，应该是被黑了，我们当即决定先把短信调用的屏蔽，但是我们在日志中还是能够看到，短信发送请求的接口还在被调用。

到这时已经可以确定的是黑客是通过对外暴露的http接口进行调用的，那么如何才能避免这样的接口落入敌人的魔爪呢？在其他的接口的调用需要判断调用这个接口的是否是用户，这部分是通过session判断的，对于账户修改中的短信接口可以通过session来判断，但是用户的注册接口是需要在用户未登录的时候尽心的，这里的接口是没办法做校验的，只能通过限制只能是正常的请求才能发送，所谓的正常的请求就是该请求是一位思想积极向上的客户发出的，如何确认该请求是好心肠的客户发出的呢？这就需要客户自己来认证，



